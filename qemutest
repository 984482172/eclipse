/usr/libexec/qemu-kvm \
-name 'avocado-vt-vm1'  \
-sandbox off  \
-machine pc  \(-M pseries,max-cpu-compat=power8)
-nodefaults  \
-vga cirrus  \
-chardev socket,id=qmp_id_catch_monitor,path=/var/tmp/monitor-catch_monitor0,server,nowait \
-mon chardev=qmp_id_catch_monitor,mode=control \
-device pvpanic,ioport=0x505,id=id6KSSzk  \
-chardev socket,id=serial_id_serial0,path=/var/tmp/serial-serial0,server,nowait \
-device isa-serial,chardev=serial_id_serial0  \
-chardev socket,id=seabioslog_id_20180626-083230-Om7lITnZ,path=/var/tmp/seabiosO,server,nowait \
-device isa-debugcon,chardev=seabioslog_id_20180626-083230-Om7lITnZ,iobase=0x402 \
-device nec-usb-xhci,id=usb1,bus=pci.0,addr=0x3 \
-device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x4 \
-drive id=drive_image1,if=none,snapshot=off,aio=threads,cache=none,format=qcow2,file=/home/zhenyzha/RHEL8.img \
-device scsi-hd,id=image1,drive=drive_image1 \
-device virtio-net-pci,mac=9a:8e:8f:90:91:92,id=idZiNCIw,vectors=4,netdev=idDRE1on,bus=pci.0,addr=0x5 \
-netdev tap,id=idDRE1on,vhost=on \
-m 8192  \
-smp 8,cores=4,threads=1,sockets=2  \
-device usb-tablet,id=usb-tablet1,bus=usb1.0,port=1  \
-device usb-kbd,id=usb-kbd1,bus=usb1.0,port=2  \
-vnc :0  \
-rtc base=utc,clock=host,driftfix=slew  \
-boot menu=off,strict=off,order=cdn,once=c \
-enable-kvm \
-monitor stdio

blockdev
#!/bin/bash
#RHEL8-94701 - [virtual block][virtio scsi] online enlarge and shrink virtio-scsi data disk     
/usr/libexec/qemu-kvm -enable-kvm -m 2048 -smp 4,cores=4 \
-device virtio-scsi-pci,id=virtio_scsi_pci0,addr=0x4 \
-device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x5 \
-device virtio-net-pci,mac=00:16:3e:22:22:22,id=testid,vectors=4,netdev=idDRE1on,bus=pci.0,addr=0x6 \ 半虚拟网络
-netdev tap,id=idDRE1on,vhost=on \ 
-blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data.qcow2,node-name=my_file \  磁盘内容
-blockdev driver=qcow2,node-name=my,file=my_file \
-blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data2.qcow2,node-name=my_file2 \  磁盘内容
-blockdev driver=qcow2,node-name=my2,file=my_file2 \
-device scsi-hd,drive=my,bus=virtio_scsi_pci0.0,bootindex=0 \    磁盘框架指定盘片(驱动)
-device scsi-hd,drive=my2,bus=virtio_scsi_pci0.0,bootindex=1 \
-cdrom /mnt/isos/linux/RHEL-8.0-20181220.1-ppc64le-dvd1.iso \
-device usb-tablet \     固定鼠标不漂移
-vnc :03 \
-serial stdio \   在当前cmd显示guest窗口


   -device pcie-root-port,id=pcie.0-root-port-9,slot=9,chassis=9,addr=0x9,bus=pcie.0 \
    -device virtio-scsi-pci,id=virtio_scsi_pci1,bus=pcie.0-root-port-9,addr=0x0 \
    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data.qcow2,node-name=data_disk \
    -blockdev driver=qcow2,node-name=disk1,file=data_disk \
    -device scsi-hd,drive=disk1,bus=virtio_scsi_pci1.0,id=data_disk \
    
 blockdev usage: (it's a must for RHEL8 testing)

    luks:

    -object secret,id=sec0,data=base -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.luks,node-name=my_file 
    -blockdev driver=luks,node-name=disk,file=my_file,key-secret=sec0

    qcow2:

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.qcow2,node-name=my_file 
    -blockdev driver=qcow2,node-name=my,file=my_file 

    raw:

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.img,node-name=my_file 
    -blockdev driver=raw,node-name=disk,file=my_file

    scsi cd(file node and raw node) and readonly must be on: 

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=winutils.iso,node-name=cd_file,read-only=on 
    -blockdev driver=raw,node-name=cd,file=cd_file,read-only=on

virtio-scsi
-device virtio-scsi-pci,bus=pci.0,addr=0x07,id=scsi-pci-1 \      (scsi模式可以有256个target，每个target可以有16384个lun)
-drive file=/home/zhenyzha/data2.qcow2,format=qcow2,if=none,aio=native,cache=none,media=disk,werror=stop,rerror=stop,id=drive-1 \
-device scsi-hd,bus=scsi-pci-1.0,id=scsi-hd-1,drive=drive-1,channel=0,scsi-id=0,lun=1,bootindex=0 \
-drive file=/home/zhenyzha/data3.img,format=qcow2,if=none,aio=native,cache=none,media=disk,werror=stop,rerror=stop,id=drive-2 \
-device scsi-hd,bus=scsi-pci-1.0,id=scsi-hd-2,drive=drive-2,channel=0,scsi-id=0,lun=2,bootindex=1 \
#备注：virtio-scsi-pci是raid卡上的一个target通道，不同的id区分不同的通道。


virtio-blk                                                       （blk模式PCI：存储设备 1：1对应，PCI总线32条最多32个磁盘占用）
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio0-0-0,id=virtio0-0-0,bootindex=0 \
-drive file=/home/zhenyzha-nfs/test1/1.img,if=none,id=drive-virtio0-0-0,media=disk,werror=stop,rerror=stop,cache=none,format=raw \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio0-0-1,id=virtio0-0-1,bootindex=1 \
-drive file=/home/zhenyzha-nfs/test1/2.img,if=none,id=drive-virtio0-0-1,media=disk,werror=stop,rerror=stop,cache=none,format=raw \



cat > /etc/qemu-ifup << EOF
#!/bin/sh
switch=switch
ip link set \$1 up
ip link set dev \$1 master \${switch}
ip link set \${switch} type bridge forward_delay 0
ip link set \${switch} type bridge stp_state 0
EOF
cat > /etc/qemu-ifdown << EOF
#!/bin/sh
switch=switch
ip link set \$1 down
ip link set dev \$1 nomaster
EOF
chmod a+rx /etc/qemu-if*
https://gitlab.cee.redhat.com/yhong/vmt


