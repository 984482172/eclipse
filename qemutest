 
/usr/libexec/qemu-kvm \
-name 'ppc-block-testvm1' \
-sandbox off  \
-machine pseries  \
-nodefaults  \
-vga std  \
-chardev socket,id=qmp_catch_monitorppc1,path=/var/tmp/monitor-catch_monitorppc1,server,nowait \
-mon chardev=qmp_catch_monitorppc1,mode=control  \
-chardev socket,id=serial_id_serialppc1,path=/var/tmp/serial-serialppc1,server,nowait \
-device spapr-vty,reg=0x30000000,chardev=serial_id_serialppc1 \
-device nec-usb-xhci,id=usbppc1,bus=pci.0,addr=0x3 \
-blockdev driver=file,filename=/root/rheltest.qcow2,cache.direct=off,cache.no-flush=on,node-name=sysdisk \
-blockdev driver=qcow2,file=sysdisk,node-name=drive_imageppc1 \
-device virtio-scsi-pci,id=virtio_scsi_pcippc1,bus=pci.0,addr=0x4 \
-device scsi-hd,id=imageppc1,drive=drive_imageppc1,werror=stop,rerror=stop \
-m 8192  \
-smp 8,cores=4,threads=1,sockets=2  \
-device usb-tablet,id=usb-tabletppc1,bus=usbppc1.0,port=1  \
-device usb-kbd,id=usb-kbdppc1,bus=usbppc1.0,port=2  \
-vnc :1 \
-rtc base=utc,clock=host  \
-enable-kvm \
-qmp tcp:0:4441,server,nowait \
-netdev tap,id=tap1,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown,vhost=on \
-device virtio-net-pci,netdev=tap1,id=nic1,mac=1a:59:0a:4b:5a:94 \
-serial tcp:0:3331,server,nowait \
-monitor stdio \
-boot menu=off,strict=off,order=cdn,once=c \
--- boot from cd --
-boot order=cd
-cdrom $file_name


#!/bin/bash
#RHEL8-94701      
/usr/libexec/qemu-kvm -enable-kvm -m 4096 -smp 4,cores=4,threads=1,sockets=1 \
-name zhenyzha-RHEL-8.0-20181220.1 \
-M pseries,max-cpu-compat=power9 \
-nodefaults \
-device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x5 \
-device virtio-net-pci,mac=00:16:3e:22:22:22,id=testid,vectors=4,netdev=idDRE1on,bus=pci.0,addr=0x6 \
-netdev tap,id=idDRE1on,vhost=on,script=/etc/qemu-ifup \
-device nec-usb-xhci,id=xhci \
-device usb-tablet,id=usb-tablet0 \
-device usb-kbd,id=usb-kbd0 \
-vnc :03 \
-qmp unix:/var/tmp/qmp-monitor-zhenyzha,server,nowait \
-qmp tcp:0:4441,server,nowait \
-serial stdio \
-boot order=cdn,once=d,menu=off,strict=off \
-drive media=cdrom,file= \



-device virtio-scsi-pci,id=virtio_scsi_pci0,addr=0x4 \
-blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data.qcow2,node-name=my_file \  磁盘内容
-blockdev driver=qcow2,node-name=my,file=my_file \
-device scsi-hd,drive=my,bus=virtio_scsi_pci0.0,bootindex=0 \    磁盘框架指定盘片(驱动)

-blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data2.qcow2,node-name=my_file2 \  磁盘内容
-blockdev driver=qcow2,node-name=my2,file=my_file2 \
-device scsi-hd,drive=my2,bus=virtio_scsi_pci0.0,bootindex=1 \

scsi-cd的用法
-blockdev driver=raw,file.driver=file,node-name=drive_cd1,cache.no-flush=on,cache.direct=off,file.filename=/mnt/os/RHEL-8.0-20190116.1-ppc64le-dvd1.iso,read-only=on \
-device scsi-cd,id=cd1,drive=drive_cd1,bootindex=0 \


Blockdev usage:
   -device pcie-root-port,id=pcie.0-root-port-9,slot=9,chassis=9,addr=0x9,bus=pcie.0 \
    -device virtio-scsi-pci,id=virtio_scsi_pci1,bus=pcie.0-root-port-9,addr=0x0 \
    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=data.qcow2,node-name=data_disk \
    -blockdev driver=qcow2,node-name=disk1,file=data_disk \
    -device scsi-hd,drive=disk1,bus=virtio_scsi_pci1.0,id=data_disk \
    
 blockdev usage: (it's a must for RHEL8 testing)

    luks:

    -object secret,id=sec0,data=base -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.luks,node-name=my_file 
    -blockdev driver=luks,node-name=disk,file=my_file,key-secret=sec0

    qcow2:

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.qcow2,node-name=my_file 
    -blockdev driver=qcow2,node-name=my,file=my_file 

    raw:

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=base.img,node-name=my_file 
    -blockdev driver=raw,node-name=disk,file=my_file

    scsi cd(file node and raw node) and readonly must be on: 

    -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=winutils.iso,node-name=cd_file,read-only=on 
    -blockdev driver=raw,node-name=cd,file=cd_file,read-only=on

virtio-scsi
-device virtio-scsi-pci,bus=pci.0,addr=0x07,id=scsi-pci-1 \      (scsi模式可以有256个target，每个target可以有16384个lun)
-drive file=/home/zhenyzha/data2.qcow2,format=qcow2,if=none,aio=native,cache=none,media=disk,werror=stop,rerror=stop,id=drive-1 \
-device scsi-hd,bus=scsi-pci-1.0,id=scsi-hd-1,drive=drive-1,channel=0,scsi-id=0,lun=1,bootindex=0 \
-drive file=/home/zhenyzha/data3.img,format=qcow2,if=none,aio=native,cache=none,media=disk,werror=stop,rerror=stop,id=drive-2 \
-device scsi-hd,bus=scsi-pci-1.0,id=scsi-hd-2,drive=drive-2,channel=0,scsi-id=0,lun=2,bootindex=1 \
#备注：virtio-scsi-pci是raid卡上的一个target通道，不同的id区分不同的通道。


virtio-blk                                                       （blk模式PCI：存储设备 1：1对应，PCI总线32条最多32个磁盘占用）
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio0-0-0,id=virtio0-0-0,bootindex=0 \
-drive file=/home/zhenyzha-nfs/test1/1.img,if=none,id=drive-virtio0-0-0,media=disk,werror=stop,rerror=stop,cache=none,format=raw \
-device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio0-0-1,id=virtio0-0-1,bootindex=1 \
-drive file=/home/zhenyzha-nfs/test1/2.img,if=none,id=drive-virtio0-0-1,media=disk,werror=stop,rerror=stop,cache=none,format=raw \


-object iothread,id=iothread1 \
-device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x6,iothread=iothread1 \
......
-device virtio-blk-pci, ..., iothread=iothread1 \


