Create image on NBD server side:
# qemu-img create -f qcow2  -o preallocation=full/falloc test.qcow2 20G
NBD img 创建需要增加preallocation参数，因为NBD 本身不会标记未被使用的元数据，所以当使用qcow2格式映射时，NBD只会读取系统使用的大小，
但写入时因为NBD本身映射为raw格式，所以后面qcow2格式的未被标记的会写入不进去。

RHEL7-86439 case error
 Implement TLS support to NBD Build-in Server	
 There are too many errors in the step, causing the case to fail to execute.
 1.No TLS configuration steps
 2.The command line is too simple, there is no explanatory information, 
 and you can't refer to writing the full command line.
 3.Start nbd server in monitor steps command error，parameter error，causes the overall case to fail to execute.


mkdir -p /etc/pki/qemu
cd /etc/pki/qemu/

2.14.1 Setup the Certificate Authority

yum -y install gnutls-utils
certtool --generate-privkey > ca-key.pem
[root@ibm-p8-garrison-03 qemu]# cat > ca.info <<EOF
cn = redhat
ca
cert_signing_key
EOF

[root@ibm-p8-garrison-03 qemu]# certtool --generate-self-signed \
--load-privkey ca-key.pem \
--template ca.info \
--outfile ca-cert.pem \

# cat > server-redhat.info <<EOF
organization = redhat
cn = localhost
dns_name = rhts
dns_name = rhts.eng.bos.redhat.com
ip_address = 10.16.67.230
ip_address = 10.16.71.254
ip_address = 2620:52:0:1040:51bb:1c66:13e2:8f66
ip_address = fe80::27f4:6b19:9112:90db
tls_www_server
encryption_key
signing_key
EOF

# certtool --generate-privkey > server-redhat-key.pem
# certtool --generate-certificate \
--load-ca-certificate ca-cert.pem \
--load-ca-privkey ca-key.pem \
--load-privkey server-redhat-key.pem \
--template server-redhat.info \
--outfile server-redhat-cert.pem

# cat > client-redhat.info <<EOF
country = GB
state = London
locality = City Of London
organization = redhat
cn = localhost
tls_www_client
encryption_key
signing_key
EOF

# certtool --generate-privkey > client-redhat-key.pem
# certtool --generate-certificate \
--load-ca-certificate ca-cert.pem \
--load-ca-privkey ca-key.pem \
--load-privkey client-redhat-key.pem \
--template client-redhat.info \
--outfile client-redhat-cert.pem

mv server-redhat-cert.pem server-cert.pem
mv client-redhat-cert.pem client-cert.pem
mv server-redhat-key.pem server-key.pem
mv client-redhat-key.pem client-key.pem

qemu中使用
$QEMU -object tls-creds-x509,id=tls0,dir=/etc/pki/qemu,endpoint=server
$QEMU -object tls-creds-x509,id=tls0,dir=/etc/pki/qemu,endpoint=client
$QEMU -vnc 0.0.0.0:0,tls-creds=tls0
