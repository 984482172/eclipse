Test result (LUKS):
For local
Basic test (install, boot, reboot, shutdown) ---- pass
/usr/libexec/qemu-kvm \
        -name 'guest-rhel7.5' \
        -machine pc \
        -nodefaults \
        -vga qxl \
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=$1,node-name=my_file \
        -blockdev driver=luks,node-name=my,file=my_file,key-secret=sec0 \
        -device scsi-hd,drive=my \
        -drive id=drive_cd1,if=none,snapshot=off,aio=threads,cache=unsafe,media=cdrom,file=$2  \
        -device ide-cd,id=cd1,drive=drive_cd1,bus=ide.0,unit=0 \
        -vnc :0 \
        -monitor stdio \
        -m 8192 \
        -smp 8 \
        -device virtio-net-pci,mac=9a:b5:b6:b1:b2:b3,id=idMmq1jH,vectors=4,netdev=idxgXAlm,bus=pci.0,addr=0x9  \
        -netdev tap,id=idxgXAlm \
        -chardev socket,id=qmp_id_qmpmonitor1,path=/var/tmp/timao/monitor-qmpmonitor1-20180220-094308-h9I6hRsI,server,nowait \
        -mon chardev=qmp_id_qmpmonitor1,mode=control  \

OR 
    …...
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=luks,cache.direct=off,cache.no-flush=on,file.filename=$1,node-name=my_file,file.driver=file,key-secret=sec0 \
        -device scsi-hd,drive=my_file \
    …...
block_add/delete ---- pass

For nfs (v3, soft)
Basic test (install, boot, reboot, shutdown) ---- pass
block_add/delete ---- pass

For rbd:
Boot with below error --- pass
…...
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=rbd,cache.direct=off,cache.no-flush=on,node-name=my_file,pool=rbd,image=timao_base.luks,server.0.host=10.73.196.181,server.0.port=6789 \
        -blockdev driver=luks,node-name=my,file=my_file,key-secret=sec0 \
        -device scsi-hd,drive=my \
    ……
OR     
    …...
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=luks,cache.direct=off,cache.no-flush=on,node-name=my_file,file.driver=rbd,file.pool=rbd,file.image=timao_base.luks,file.server.0.host=10.73.196.181,file.server.0.port=6789,key-secret=sec0 \
        -device scsi-hd,drive=my_file \
…...
block_add/delete --- pass
{"execute": "blockdev-add", "arguments": {"node-name": "drive2", "driver": "raw", "file": {"driver": "rbd", "pool": "rbd", "image": "timao_data.img", "server" : [{ "host": "10.73.196.181", "port":"6789"}]}}}
        
For libiscsi
Basic function(install, boot, reboot, shutdown) --- pass
…...
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=iscsi,cache.direct=off,cache.no-flush=on,node-name=my_file,transport=tcp,portal=10.73.224.153,target=iqn.2018-09.com.example:t1,initiator-name=iqn.2018-11.com.example:auth,lun=0 \
        -blockdev driver=luks,node-name=my,file=my_file,key-secret=sec0 \
        -device scsi-hd,drive=my \
    …….
OR
    …...
    -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=luks,cache.direct=off,cache.no-flush=on,node-name=my_file,file.driver=iscsi,file.transport=tcp,file.portal=10.73.224.153,file.target=iqn.2018-09.com.example:t1,file.lun=0,key-secret=sec0 \
        -device scsi-hd,drive=my_file \
    ……

Full command:
-object secret,id=sec0,data=redhat \
-blockdev driver=iscsi,cache.direct=off,cache.no-flush=on,node-name=my_file,transport=tcp,portal=10.73.224.153,target=iqn.2018-09.com.example:t1,initiator-name=iqn.2018-11.com.example:auth,lun=0,user=redhat,password-secret=sec0 \
-blockdev driver=qcow2/raw,node-name=my,file=my_file \


block_add/delete - pass
        {
        "execute": "blockdev-add",
                "arguments": {
                        "node-name": "drive2",
                        "driver": "qcow2",
                        "file": {
                            "driver":"iscsi",
                            "transport":"tcp",
                            "portal":"10.73.196.47",
                            "target":"iqn.2018-11.com.example:server",
                            "lun":2
                            }
                    }
}


For FC
Basic function(install, boot, reboot, shutdown) --- pass
        ……
            -object secret,id=sec0,data=base \
    -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
            -blockdev driver=luks,cache.direct=off,cache.no-flush=on,node-name=my_file,file.filename=/dev/vg1/base.luks,node-name=my_file,file.driver=file,key-secret=sec0 \
            -device scsi-hd,drive=my_file \
        ……
        OR 
        ……
            -object secret,id=sec0,data=base \
            -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
            -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=$1,node-name=my_file \
            -blockdev driver=luks,node-name=my,file=my_file,key-secret=sec0 \
            -device scsi-hd,drive=my \
        …...
block_add/delete --- pass
{"execute": "blockdev-add","arguments": {"node-name": "drive2","driver": "raw", "file":    {"driver":"file", "filename": "/dev/vg1/data.img"}}}

For glusterfs(mount -t glusterfs)
Basic function(install, boot, reboot, shutdown) --- pass
            ……
-device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3
-blockdev driver=luks,cache.direct=off,cache.no-flush=on,node-name=my_file,file.filename=base.luks,file.driver=file,key-secret=sec0 
-device scsi-hd,drive=my_file
……
OR 
    …...
    -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=file,cache.direct=off,cache.no-flush=on,filename=$1,node-name=my_file \
        -blockdev driver=luks,node-name=my,file=my_file,key-secret=sec0 \
        -device scsi-hd,drive=my \
    …...
block_add/delete ---- pass

For NBD  
Basic function(install, boot, reboot, shutdown) --- pass
……
-device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
-blockdev driver=raw,cache.direct=off,cache.no-flush=on,node-name=my_file,file.driver=nbd,file.server.host=10.73.194.81,file.server.port=9000,file.server.type=inet \
-device scsi-hd,drive=my_file \
……
OR 
……
-device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
-blockdev driver=nbd,cache.direct=off,cache.no-flush=on,node-name=my_file,server.host=10.73.194.81,server.port=9000,server.type=inet \
-blockdev driver=raw,node-name=my,file=my_file \
-device scsi-hd,drive=my \
…...
block_add/delete --- pass
{"execute": "blockdev-add","arguments": {"node-name": "drive2","driver": "raw", "file": {"driver":"nbd", "server":{"host": "10.73.194.81", "port": "9001", "type":"inet"} }}}

For nvme --- by coli
Basic function(install, boot, reboot, shutdown)
For iscsi(local+lvs) - by xuwei
For libgfapi:
…...
-blockdev driver=gluster,cache.direct=off,cache.no-flush=on,node-name=my_file,volume=vol,path=test.qcow2,server.0.type=inet,server.0.host=10.66.144.31,server.0.port=24007 \
-blockdev driver=raw/qcow2,node-name=my,file=my_file 
        -device virtio-blk-pci,id=virtio_blk_pci0,drive=my_file,bus=pcie.0,addr=05,bootindex=0 \
…...        
        or
    …...
-blockdev driver=qcow2,cache.direct=off,cache.no-flush=on,node-name=my_file,file.driver=gluster,file.volume=vol,file.path=test.qcow2,file.server.0.type=inet,file.server.0.host=10.66.144.31,file.server.0.port=24007 \
        -device virtio-blk-pci,id=virtio_blk_pci0,drive=my_file,bus=pcie.0,addr=05,bootindex=0 \
    ……
Full command:
…...
-blockdev driver=gluster,cache.direct=off,cache.no-flush=on,node-name=my_file,volume=vol,path=test.qcow2,server.0.type=inet,server.0.host=10.66.144.31,server.0.port=24007,debug=$level,logfile=/path/to/logfile \
-blockdev driver=raw/qcow2,node-name=my,file=my_file 
        -device virtio-blk-pci,id=virtio_blk_pci0,drive=my_file,bus=pcie.0,addr=05,bootindex=0 \
…...

Test result (luks-inside-qcow2 with libiscsi):
Basic function(install, boot, reboot, shutdown) --- pass
……
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=iscsi,cache.direct=off,cache.no-flush=on,node-name=my_file,transport=tcp,portal=10.73.224.153,target=iqn.2018-09.com.example:t1,lun=0 \
        -blockdev driver=qcow2,node-name=my,file=my_file,encrypt.key-secret=sec0,encrypt.format=luks \
        -device scsi-hd,drive=my \
    ……
OR 
……
        -object secret,id=sec0,data=base \
        -device virtio-scsi-pci,id=virtio_scsi_pci0,bus=pci.0,addr=0x3 \
        -blockdev driver=qcow2,cache.direct=off,cache.no-flush=on,node-name=my_file,file.driver=iscsi,file.transport=tcp,file.portal=10.73.224.153,file.target=iqn.2018-09.com.example:t1,file.lun=0,encrypt.format=luks,encrypt.key-secret=sec0 \
        -device scsi-hd,drive=my_file \


…...
block_add/delete --- pass
        {
        "execute": "blockdev-add",
                "arguments": {
                        "node-name": "drive2",
                        "driver": "raw",
                        "file": {
                            "driver":"iscsi",
                            "transport":"tcp",
                            "portal":"10.73.224.153",
                            "target":"iqn.2018-09.com.example:t1",
                            "lun":1
                            }
                    }
}
